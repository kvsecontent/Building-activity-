<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hop Hundreds Home - Interactive Learning Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 2.5em;
            color: #2E8B57;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 20px;
        }

        /* Tab Navigation */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #e0e0e0;
        }

        .tab-button {
            background: #f5f5f5;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            border-radius: 10px 10px 0 0;
            margin: 0 5px;
            transition: all 0.3s ease;
            color: #333;
        }

        .tab-button.active {
            background: #4CAF50;
            color: white;
            transform: translateY(3px);
        }

        .tab-button:hover:not(.active) {
            background: #e0e0e0;
        }

        .tab-content {
            min-height: 500px;
        }

        .tab-content.hidden {
            display: none;
        }

        /* Building Activity Styles */
        .instructions {
            background: #FFF8E1;
            border: 2px solid #FFC107;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .instructions h3 {
            color: #F57C00;
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-primary { background: #4CAF50; color: white; }
        .btn-secondary { background: #FF9800; color: white; }
        .btn-danger { background: #f44336; color: white; }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .building-container {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        .building {
            background: #f0f0f0;
            border: 3px solid #333;
            border-radius: 15px;
            padding: 20px;
            position: relative;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .building-title {
            background: #333;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            margin: -20px -20px 20px -20px;
            border-radius: 12px 12px 0 0;
            font-size: 1.1em;
        }

        .apartment-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 3px;
            background: #ddd;
            padding: 10px;
            border-radius: 10px;
        }

        /* PRECISE FLOOR LABEL ALIGNMENT */
        .floor-labels {
            position: absolute;
            left: -65px;
            top: 60px; /* Exact alignment with first apartment row */
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .floor-label {
            height: 45px; /* Match apartment height exactly */
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #666;
            font-size: 0.75em;
            text-align: center;
            width: 55px;
        }

        .apartment {
            width: 45px;
            height: 45px;
            border: 2px solid #666;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .apartment.given {
            background: #E3F2FD;
            border-color: #1976D2;
            color: #1976D2;
        }

        .apartment.student-filled {
            background: #E8F5E8;
            border-color: #4CAF50;
            color: #2E7D32;
        }

        .apartment.highlighted {
            background: #FFF3E0;
            border-color: #FF9800;
            box-shadow: 0 0 10px rgba(255, 152, 0, 0.5);
        }

        .apartment.missing {
            background: #FFEBEE;
            border-color: #E91E63;
            border-style: dashed;
        }

        .apartment:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .number-cards {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .cards-section {
            background: #f9f9f9;
            border-radius: 15px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .cards-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .number-card {
            width: 60px;
            height: 40px;
            background: #FFE082;
            border: 2px solid #FFA000;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: grab;
            transition: all 0.3s ease;
            user-select: none;
        }

        .number-card:hover {
            transform: scale(1.1);
            background: #FFCC02;
        }

        .number-card.dragging {
            cursor: grabbing;
            transform: rotate(5deg) scale(1.1);
            z-index: 1000;
        }

        .number-card.used {
            background: #E0E0E0;
            border-color: #999;
            color: #666;
            cursor: not-allowed;
        }

        .pattern-hint {
            background: #E1F5FE;
            border: 2px solid #0277BD;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            display: none;
        }

        .pattern-hint.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        .success-message {
            background: #E8F5E8;
            border: 2px solid #4CAF50;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
            color: #2E7D32;
            display: none;
        }

        .success-message.show {
            display: block;
            animation: bounceIn 0.6s ease;
        }

        .stats {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }

        .stat {
            background: #F5F5F5;
            padding: 10px 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2E8B57;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
        }

        /* Quiz Styles */
        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .quiz-title {
            text-align: center;
            color: #2E8B57;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .quiz-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f0f0f0;
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .score {
            color: #4CAF50;
            font-size: 1.1em;
        }

        .question-card {
            background: white;
            border: 3px solid #4CAF50;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .question-content h3 {
            color: #2E8B57;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .question-content p {
            font-size: 1.1em;
            margin-bottom: 25px;
            color: #333;
        }

        .answer-area {
            margin: 30px 0;
        }

        .answer-boxes {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
            align-items: center;
        }

        .answer-box {
            text-align: center;
        }

        .box-label {
            font-weight: bold;
            color: #666;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .drop-zone {
            width: 80px;
            height: 60px;
            border: 3px dashed #ccc;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            transition: all 0.3s ease;
            background: #f9f9f9;
        }

        .drop-zone.drag-over {
            border-color: #4CAF50;
            background: #E8F5E8;
            transform: scale(1.05);
        }

        .drop-zone.filled {
            border-color: #4CAF50;
            border-style: solid;
            background: #E8F5E8;
            color: #2E7D32;
        }

        .drop-zone.correct {
            border-color: #4CAF50;
            background: #C8E6C8;
            animation: correctPulse 0.6s ease;
        }

        .drop-zone.incorrect {
            border-color: #f44336;
            background: #FFCDD2;
            animation: incorrectShake 0.6s ease;
        }

        .plus-sign {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
            margin: 0 10px;
        }

        .draggable-options {
            text-align: center;
        }

        .options-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .options-grid {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }

        .quiz-option {
            padding: 10px 20px;
            background: #FFE082;
            border: 2px solid #FFA000;
            border-radius: 8px;
            font-weight: bold;
            cursor: grab;
            transition: all 0.3s ease;
            user-select: none;
        }

        .quiz-option:hover {
            transform: scale(1.1);
            background: #FFCC02;
        }

        .quiz-option.dragging {
            cursor: grabbing;
            transform: rotate(5deg) scale(1.1);
            z-index: 1000;
        }

        .quiz-option.used {
            background: #e0e0e0;
            border-color: #999;
            color: #666;
            cursor: not-allowed;
        }

        .quiz-controls {
            text-align: center;
            margin-top: 25px;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            text-align: center;
            display: none;
        }

        .feedback.correct {
            background: #E8F5E8;
            border: 2px solid #4CAF50;
            color: #2E7D32;
            display: block;
        }

        .feedback.incorrect {
            background: #FFEBEE;
            border: 2px solid #f44336;
            color: #C62828;
            display: block;
        }

        /* Animations */
        @keyframes celebrate {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.3) rotate(5deg); background: #4CAF50; }
            50% { transform: scale(0.9) rotate(-5deg); background: #66BB6A; }
            75% { transform: scale(1.1) rotate(2deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        @keyframes particle {
            0% { opacity: 1; transform: translate(0, 0) scale(1); }
            100% { opacity: 0; transform: translate(var(--dx), var(--dy)) scale(0); }
        }

        .celebration-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">🏢 Hop Hundreds Home</h1>
            <p class="subtitle">Interactive Place Value Learning Tool</p>
        </div>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('building')">Building Activity</button>
            <button class="tab-button" onclick="showTab('quiz')">Learning Quiz</button>
        </div>

        <!-- BUILDING TAB -->
        <div class="tab-content" id="buildingTab">
            <div class="instructions">
                <h3>Instructions for Students:</h3>
                <p>1. Look at the apartment building - some house numbers are missing!<br>
                   2. Drag number cards from the right to fill in the empty apartments<br>
                   3. Think about patterns: What happens when you go up one floor? Move right one house?<br>
                   4. Can you discover the secret pattern without counting every house?</p>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="showHint()">Show Pattern Hint</button>
                <button class="btn btn-secondary" onclick="checkAnswers()">Check My Work</button>
                <button class="btn btn-danger" onclick="resetActivity()">Start Over</button>
                <button class="btn btn-primary" onclick="revealAll()">Teacher: Reveal All</button>
            </div>

            <div class="building-container">
                <div class="building">
                    <div class="building-title">HOP HUNDREDS HOME</div>
                    <div class="floor-labels">
                        <div class="floor-label">19th</div>
                        <div class="floor-label">18th</div>
                        <div class="floor-label">17th</div>
                        <div class="floor-label">16th</div>
                        <div class="floor-label">15th</div>
                        <div class="floor-label">14th</div>
                        <div class="floor-label">13th</div>
                        <div class="floor-label">12th</div>
                        <div class="floor-label">11th</div>
                        <div class="floor-label">10th</div>
                    </div>
                    <div class="apartment-grid" id="apartmentGrid"></div>
                </div>

                <div class="number-cards">
                    <div class="cards-section">
                        <div class="cards-title">Drag These Numbers</div>
                        <div class="cards-grid" id="numberCards"></div>
                    </div>
                </div>
            </div>

            <div class="pattern-hint" id="patternHint">
                <h3>🔍 Pattern Discovery Hint:</h3>
                <p>When you move <strong>up one floor</strong>, what happens to the house number?<br>
                   When you move <strong>right one house</strong>, what happens to the house number?<br>
                   <em>Try placing 115 above 105 and see what you notice!</em></p>
            </div>

            <div class="success-message" id="successMessage">
                <h3>🎉 Excellent Work!</h3>
                <p>You've discovered the apartment building pattern! Moving up one floor adds 10 to the house number.</p>
            </div>

            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="correctCount">0</div>
                    <div class="stat-label">Correct</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="totalMissing">0</div>
                    <div class="stat-label">Missing</div>
                </div>
            </div>
        </div>

        <!-- QUIZ TAB -->
        <div class="tab-content hidden" id="quizTab">
            <div class="quiz-container">
                <h2 class="quiz-title">Learning Assessment Quiz</h2>
                <div class="quiz-progress">
                    <span>Question <span id="currentQuestion">1</span> of 10</span>
                    <div class="score">Score: <span id="score">0</span>/10</div>
                </div>
                
                <div class="question-card">
                    <div class="question-content">
                        <h3 id="questionTitle">Loading...</h3>
                        <p id="questionText">Please wait while the question loads...</p>
                        
                        <div class="answer-area">
                            <div class="answer-boxes" id="answerBoxes"></div>
                        </div>

                        <div class="draggable-options">
                            <div class="options-title">Drag these answers:</div>
                            <div class="options-grid" id="optionsGrid"></div>
                        </div>

                        <div class="quiz-controls">
                            <button class="btn btn-secondary" onclick="checkQuizAnswer()">Check Answer</button>
                            <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn" style="display: none;">Next Question</button>
                            <button class="btn btn-danger" onclick="resetQuiz()">Reset Quiz</button>
                        </div>

                        <div class="feedback" id="feedback"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Building Activity Data
        const givenNumbers = [101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 127, 138, 143, 155, 160, 170, 174, 186];
        const allNumbers = [];
        const missingNumbers = [];
        const studentAnswers = {};
        let draggedElement = null;

        // Generate all apartment numbers 101-200
        for (let i = 101; i <= 200; i++) {
            allNumbers.push(i);
            if (!givenNumbers.includes(i)) {
                missingNumbers.push(i);
            }
        }

        // Quiz Data - EXACTLY 10 QUESTIONS
        const quizQuestions = [
            {
                title: "Place Value Understanding",
                question: "Break down the number 247 into its place values:",
                labels: ["Hundreds", "Tens", "Ones"],
                options: ["2", "4", "7", "24", "47", "200"],
                correctAnswers: ["2", "4", "7"],
                explanation: "247 = 2 hundreds + 4 tens + 7 ones",
                showPlus: false
            },
            {
                title: "Place Value Understanding",
                question: "What is 365 in expanded form?",
                labels: ["", "", ""],
                options: ["300", "60", "5", "3", "6", "36"],
                correctAnswers: ["300", "60", "5"],
                explanation: "365 = 300 + 60 + 5",
                showPlus: true
            },
            {
                title: "Pattern Recognition",
                question: "Complete the apartment sequence: 125, 135, ?, 155",
                labels: ["Missing", "Pattern", "Rule"],
                options: ["145", "+10", "floor up", "140", "+5", "150"],
                correctAnswers: ["145", "+10", "floor up"],
                explanation: "Going up one floor adds 10 to the apartment number",
                showPlus: false
            },
            {
                title: "Pattern Recognition",
                question: "If apartment 167 is on floor 16, what floor is apartment 187?",
                labels: ["Floor", "Difference", "Rule"],
                options: ["18", "20", "17", "+10", "+20", "up 2"],
                correctAnswers: ["18", "+20", "up 2"],
                explanation: "187 - 167 = 20, so 2 floors higher (16 + 2 = 18)",
                showPlus: false
            },
            {
                title: "Number Comparison",
                question: "Compare these numbers: 234 __ 243",
                labels: ["First", "Symbol", "Second"],
                options: ["234", "<", "243", ">", "=", "342"],
                correctAnswers: ["234", "<", "243"],
                explanation: "234 is less than 243 because 34 < 43 in the tens and ones places",
                showPlus: false
            },
            {
                title: "Number Comparison",
                question: "Order from smallest to greatest: 189, 198, 181",
                labels: ["Smallest", "Greatest"],
                options: ["181", "189", "198", "819", "891", "981"],
                correctAnswers: ["181", "198"],
                explanation: "Compare hundreds first, then tens: 181 is smallest, 198 is greatest",
                showPlus: false
            },
            {
                title: "Place Value Understanding",
                question: "What digit is in the tens place of 356?",
                labels: ["Tens Digit"],
                options: ["3", "5", "6", "35", "56", "350"],
                correctAnswers: ["5"],
                explanation: "In 356, the digit 5 is in the tens place",
                showPlus: false
            },
            {
                title: "Pattern Recognition",
                question: "What comes next: 142, 152, 162, ?",
                labels: ["Next Number"],
                options: ["172", "170", "163", "182", "165", "175"],
                correctAnswers: ["172"],
                explanation: "The pattern adds 10 each time (same floor pattern as apartments)",
                showPlus: false
            },
            {
                title: "Place Value Understanding",
                question: "Write 456 in expanded form:",
                labels: ["", "", ""],
                options: ["400", "50", "6", "4", "5", "450"],
                correctAnswers: ["400", "50", "6"],
                explanation: "456 = 400 + 50 + 6",
                showPlus: true
            },
            {
                title: "Number Comparison",
                question: "Which symbol makes this true: 278 __ 287",
                labels: ["Symbol"],
                options: ["<", ">", "=", "+", "-", "×"],
                correctAnswers: ["<"],
                explanation: "278 < 287 because 78 is less than 87 in the tens and ones",
                showPlus: false
            }
        ];

        let currentQuestionIndex = 0;
        let quizScore = 0;
        let draggedQuizElement = null;

        // Initialize Building Activity
        function initializeActivity() {
            createApartmentGrid();
            createNumberCards();
            updateStats();
        }

        function createApartmentGrid() {
            const grid = document.getElementById('apartmentGrid');
            grid.innerHTML = '';

            for (let row = 0; row < 10; row++) {
                for (let col = 0; col < 10; col++) {
                    const houseNumber = (190 - row * 10) + (col + 1);
                    const apartment = document.createElement('div');
                    apartment.className = 'apartment';
                    apartment.dataset.number = houseNumber;

                    if (givenNumbers.includes(houseNumber)) {
                        apartment.textContent = houseNumber;
                        apartment.classList.add('given');
                    } else {
                        apartment.classList.add('missing');
                    }

                    apartment.addEventListener('dragover', handleDragOver);
                    apartment.addEventListener('drop', handleDrop);
                    apartment.addEventListener('click', handleApartmentClick);
                    grid.appendChild(apartment);
                }
            }
        }

        function createNumberCards() {
            const cardsContainer = document.getElementById('numberCards');
            cardsContainer.innerHTML = '';
            const shuffled = [...missingNumbers].sort(() => Math.random() - 0.5);

            shuffled.forEach(number => {
                const card = document.createElement('div');
                card.className = 'number-card';
                card.textContent = number;
                card.dataset.number = number;
                card.draggable = true;
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
                cardsContainer.appendChild(card);
            });
        }

        // Drag and Drop Handlers
        function handleDragStart(e) {
            draggedElement = e.target;
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedElement = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDrop(e) {
            e.preventDefault();
            if (draggedElement && e.target.classList.contains('missing')) {
                const houseNumber = parseInt(e.target.dataset.number);
                const cardNumber = parseInt(draggedElement.dataset.number);

                if (cardNumber === houseNumber) {
                    e.target.textContent = cardNumber;
                    e.target.classList.remove('missing');
                    e.target.classList.add('student-filled');
                    draggedElement.classList.add('used');
                    draggedElement.draggable = false;
                    studentAnswers[houseNumber] = cardNumber;
                    celebrateCorrectAnswer(e.target);
                    highlightPattern(houseNumber);
                    updateStats();
                    
                    if (Object.keys(studentAnswers).length === missingNumbers.length) {
                        showSuccess();
                    }
                } else {
                    e.target.style.background = '#FFCDD2';
                    setTimeout(() => { e.target.style.background = ''; }, 1000);
                }
            }
        }

        function handleApartmentClick(e) {
            if (e.target.classList.contains('missing')) {
                const houseNumber = parseInt(e.target.dataset.number);
                const userInput = prompt(`What house number belongs here?\nHint: Think about the pattern!`);
                
                if (userInput && parseInt(userInput) === houseNumber) {
                    e.target.textContent = houseNumber;
                    e.target.classList.remove('missing');
                    e.target.classList.add('student-filled');
                    studentAnswers[houseNumber] = houseNumber;
                    celebrateCorrectAnswer(e.target);
                    highlightPattern(houseNumber);
                    updateStats();
                    
                    if (Object.keys(studentAnswers).length === missingNumbers.length) {
                        showSuccess();
                    }
                }
            }
        }

        function celebrateCorrectAnswer(apartment) {
            apartment.style.animation = 'celebrate 0.8s ease';
            const rect = apartment.getBoundingClientRect();
            const containerRect = document.querySelector('.container').getBoundingClientRect();
            const centerX = rect.left + rect.width / 2 - containerRect.left;
            const centerY = rect.top + rect.height / 2 - containerRect.top;
            
            // Create emoji flyers that burst out
            const celebrationEmojis = ['🎉', '🌟', '⭐', '🎊', '🏆', '✨', '🥳', '👍', '💫', '🎈', '🔥', '🚀'];
            
            for (let i = 0; i < 12; i++) {
                const emojiFlyer = document.createElement('div');
                emojiFlyer.textContent = celebrationEmojis[Math.floor(Math.random() * celebrationEmojis.length)];
                emojiFlyer.style.position = 'absolute';
                emojiFlyer.style.left = centerX + 'px';
                emojiFlyer.style.top = centerY + 'px';
                emojiFlyer.style.fontSize = '20px';
                emojiFlyer.style.pointerEvents = 'none';
                emojiFlyer.style.zIndex = '1000';
                emojiFlyer.style.userSelect = 'none';
                
                const angle = (i / 12) * Math.PI * 2;
                const distance = 80 + Math.random() * 60;
                const dx = Math.cos(angle) * distance;
                const dy = Math.sin(angle) * distance;
                
                // Animate the emoji flying outward
                emojiFlyer.animate([
                    {
                        transform: 'translate(0, 0) scale(0.5) rotate(0deg)',
                        opacity: 1
                    },
                    {
                        transform: `translate(${dx}px, ${dy}px) scale(1.5) rotate(360deg)`,
                        opacity: 0
                    }
                ], {
                    duration: 1500,
                    easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                });
                
                document.querySelector('.container').appendChild(emojiFlyer);
                
                setTimeout(() => {
                    if (emojiFlyer.parentNode) emojiFlyer.parentNode.removeChild(emojiFlyer);
                }, 1500);
            }

            // Add celebratory text with bounce effect
            const successMessages = ['Perfect!', 'Well Done!', 'Amazing!', 'Great Job!', 'Brilliant!'];
            const randomMessage = successMessages[Math.floor(Math.random() * successMessages.length)];
            
            const successText = document.createElement('div');
            successText.innerHTML = `🎉 ${randomMessage} 🎉`;
            successText.style.position = 'absolute';
            successText.style.left = centerX + 'px';
            successText.style.top = (centerY - 50) + 'px';
            successText.style.transform = 'translateX(-50%)';
            successText.style.color = '#FF6B6B';
            successText.style.fontWeight = 'bold';
            successText.style.fontSize = '18px';
            successText.style.pointerEvents = 'none';
            successText.style.zIndex = '1001';
            successText.style.textShadow = '2px 2px 4px rgba(0,0,0,0.3)';
            successText.style.animation = 'bounceIn 1.5s ease-out forwards';
            
            document.querySelector('.container').appendChild(successText);
            
            setTimeout(() => {
                if (successText.parentNode) successText.parentNode.removeChild(successText);
            }, 1500);

            // Add glowing effect to the apartment
            apartment.style.boxShadow = '0 0 20px #4CAF50';
            setTimeout(() => {
                apartment.style.boxShadow = '';
                apartment.style.animation = '';
            }, 800);
        }

        function highlightPattern(houseNumber) {
            const below = houseNumber - 10;
            const above = houseNumber + 10;
            
            const belowApartment = document.querySelector(`[data-number="${below}"]`);
            const aboveApartment = document.querySelector(`[data-number="${above}"]`);
            
            if (belowApartment) {
                belowApartment.classList.add('highlighted');
                setTimeout(() => belowApartment.classList.remove('highlighted'), 2000);
            }
            if (aboveApartment) {
                aboveApartment.classList.add('highlighted');
                setTimeout(() => aboveApartment.classList.remove('highlighted'), 2000);
            }
        }

        function showHint() {
            document.getElementById('patternHint').classList.add('show');
        }

        function checkAnswers() {
            let correct = 0;
            missingNumbers.forEach(num => {
                if (studentAnswers[num] === num) correct++;
            });
            const total = missingNumbers.length;
            alert(`You got ${correct} out of ${total} correct!\n${correct === total ? 'Perfect! You found the pattern!' : 'Keep trying! Look for the +10 pattern.'}`);
        }

        function resetActivity() {
            Object.keys(studentAnswers).forEach(key => delete studentAnswers[key]);
            document.querySelectorAll('.apartment').forEach(apt => {
                const num = parseInt(apt.dataset.number);
                apt.classList.remove('student-filled', 'highlighted');
                if (!givenNumbers.includes(num)) {
                    apt.classList.add('missing');
                    apt.textContent = '';
                }
            });
            document.querySelectorAll('.number-card').forEach(card => {
                card.classList.remove('used');
                card.draggable = true;
            });
            document.getElementById('patternHint').classList.remove('show');
            document.getElementById('successMessage').classList.remove('show');
            updateStats();
        }

        function revealAll() {
            missingNumbers.forEach(num => {
                const apartment = document.querySelector(`[data-number="${num}"]`);
                if (apartment && apartment.classList.contains('missing')) {
                    apartment.textContent = num;
                    apartment.classList.remove('missing');
                    apartment.classList.add('student-filled');
                    studentAnswers[num] = num;
                }
            });
            document.querySelectorAll('.number-card').forEach(card => {
                card.classList.add('used');
                card.draggable = false;
            });
            updateStats();
            showSuccess();
        }

        function showSuccess() {
            document.getElementById('successMessage').classList.add('show');
        }

        function updateStats() {
            document.getElementById('correctCount').textContent = Object.keys(studentAnswers).length;
            document.getElementById('totalMissing').textContent = missingNumbers.length;
        }

        // Tab Functions
        function showTab(tabName) {
            document.getElementById('buildingTab').classList.toggle('hidden', tabName !== 'building');
            document.getElementById('quizTab').classList.toggle('hidden', tabName !== 'quiz');
            
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            
            if (tabName === 'building') {
                document.querySelectorAll('.tab-button')[0].classList.add('active');
            } else {
                document.querySelectorAll('.tab-button')[1].classList.add('active');
                initializeQuiz();
            }
        }

        // Quiz Functions
        function initializeQuiz() {
            currentQuestionIndex = 0;
            quizScore = 0;
            loadQuestion();
        }

        function loadQuestion() {
            const question = quizQuestions[currentQuestionIndex];
            
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('score').textContent = quizScore;
            document.getElementById('questionTitle').textContent = question.title;
            document.getElementById('questionText').textContent = question.question;
            
            const answerBoxes = document.getElementById('answerBoxes');
            answerBoxes.innerHTML = '';
            
            question.labels.forEach((label, index) => {
                const answerBox = document.createElement('div');
                answerBox.className = 'answer-box';
                
                const boxLabel = document.createElement('div');
                boxLabel.className = 'box-label';
                boxLabel.textContent = label;
                
                const dropZone = document.createElement('div');
                dropZone.className = 'drop-zone';
                dropZone.addEventListener('dragover', handleQuizDragOver);
                dropZone.addEventListener('drop', handleQuizDrop);
                
                answerBox.appendChild(boxLabel);
                answerBox.appendChild(dropZone);
                answerBoxes.appendChild(answerBox);
                
                if (question.showPlus && index < question.labels.length - 1) {
                    const plusSign = document.createElement('div');
                    plusSign.className = 'plus-sign';
                    plusSign.textContent = '+';
                    answerBoxes.appendChild(plusSign);
                }
            });
            
            createQuizOptions(question.options);
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('feedback').style.display = 'none';
        }

        function createQuizOptions(options) {
            const optionsGrid = document.getElementById('optionsGrid');
            optionsGrid.innerHTML = '';
            const shuffled = [...options].sort(() => Math.random() - 0.5);
            
            shuffled.forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.textContent = option;
                optionElement.draggable = true;
                optionElement.addEventListener('dragstart', handleQuizDragStart);
                optionElement.addEventListener('dragend', handleQuizDragEnd);
                optionsGrid.appendChild(optionElement);
            });
        }

        function handleQuizDragStart(e) {
            draggedQuizElement = e.target;
            e.target.classList.add('dragging');
        }

        function handleQuizDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedQuizElement = null;
        }

        function handleQuizDragOver(e) {
            e.preventDefault();
            e.target.classList.add('drag-over');
        }

        function handleQuizDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');
            
            if (draggedQuizElement && !e.target.textContent.trim()) {
                e.target.textContent = draggedQuizElement.textContent;
                e.target.classList.add('filled');
                draggedQuizElement.classList.add('used');
                draggedQuizElement.draggable = false;
            }
        }

        function checkQuizAnswer() {
            const question = quizQuestions[currentQuestionIndex];
            const dropZones = document.querySelectorAll('.drop-zone');
            
            let allFilled = true;
            dropZones.forEach(zone => {
                if (!zone.textContent.trim()) allFilled = false;
            });
            
            if (!allFilled) {
                alert('Please fill all answer boxes before checking!');
                return;
            }
            
            const userAnswers = Array.from(dropZones).map(zone => zone.textContent.trim());
            let correct = true;
            
            dropZones.forEach((zone, index) => {
                zone.classList.remove('correct', 'incorrect');
                if (userAnswers[index] === question.correctAnswers[index]) {
                    zone.classList.add('correct');
                } else {
                    zone.classList.add('incorrect');
                    correct = false;
                }
            });
            
            const feedback = document.getElementById('feedback');
            feedback.style.display = 'block';
            
            if (correct) {
                quizScore++;
                feedback.textContent = `✓ Correct! ${question.explanation}`;
                feedback.className = 'feedback correct';
                document.getElementById('score').textContent = quizScore;
                celebrateQuizSuccess();
            } else {
                feedback.textContent = `✗ Not quite right. ${question.explanation}`;
                feedback.className = 'feedback incorrect';
            }
            
            document.getElementById('nextBtn').style.display = 'inline-block';
        }

        function celebrateQuizSuccess() {
            const questionCard = document.querySelector('.question-card');
            questionCard.style.animation = 'correctPulse 0.6s ease';
            
            // Get center position of question card for particle effects
            const rect = questionCard.getBoundingClientRect();
            const containerRect = document.querySelector('.container').getBoundingClientRect();
            const centerX = rect.left + rect.width / 2 - containerRect.left;
            const centerY = rect.top + rect.height / 2 - containerRect.top;
            
            // Create celebratory emoji flyers that burst outward
            const quizEmojis = ['🎉', '🌟', '⭐', '🎊', '🏆', '✨', '🥳', '👍', '💫', '🎈', '🔥', '🚀'];
            
            for (let i = 0; i < 18; i++) {
                const emojiFlyer = document.createElement('div');
                emojiFlyer.textContent = quizEmojis[Math.floor(Math.random() * quizEmojis.length)];
                emojiFlyer.style.position = 'absolute';
                emojiFlyer.style.left = centerX + 'px';
                emojiFlyer.style.top = centerY + 'px';
                emojiFlyer.style.fontSize = '24px';
                emojiFlyer.style.pointerEvents = 'none';
                emojiFlyer.style.zIndex = '2000';
                emojiFlyer.style.userSelect = 'none';
                
                const angle = (i / 18) * Math.PI * 2;
                const distance = 100 + Math.random() * 80;
                const dx = Math.cos(angle) * distance;
                const dy = Math.sin(angle) * distance;
                
                // Animate the emoji flying outward with spinning effect
                emojiFlyer.animate([
                    {
                        transform: 'translate(0, 0) scale(0.3) rotate(0deg)',
                        opacity: 1
                    },
                    {
                        transform: `translate(${dx}px, ${dy}px) scale(1.8) rotate(720deg)`,
                        opacity: 0
                    }
                ], {
                    duration: 2000,
                    easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                });
                
                document.querySelector('.container').appendChild(emojiFlyer);
                
                setTimeout(() => {
                    if (emojiFlyer.parentNode) emojiFlyer.parentNode.removeChild(emojiFlyer);
                }, 2000);
            }

            // Add floating celebratory text
            const celebrationMessages = ['Outstanding!', 'Correct!', 'Brilliant!', 'Well Done!', 'Fantastic!'];
            const randomMessage = celebrationMessages[Math.floor(Math.random() * celebrationMessages.length)];
            
            const floatingText = document.createElement('div');
            floatingText.innerHTML = `⭐ ${randomMessage} ⭐`;
            floatingText.style.position = 'absolute';
            floatingText.style.left = centerX + 'px';
            floatingText.style.top = (centerY - 80) + 'px';
            floatingText.style.transform = 'translateX(-50%)';
            floatingText.style.color = '#4CAF50';
            floatingText.style.fontWeight = 'bold';
            floatingText.style.fontSize = '24px';
            floatingText.style.pointerEvents = 'none';
            floatingText.style.zIndex = '2001';
            floatingText.style.textShadow = '2px 2px 4px rgba(0,0,0,0.3)';
            floatingText.style.animation = 'bounceIn 1.8s ease-out forwards';
            
            document.querySelector('.container').appendChild(floatingText);
            
            setTimeout(() => {
                if (floatingText.parentNode) floatingText.parentNode.removeChild(floatingText);
            }, 1800);

            // Add glowing border effect to question card
            questionCard.style.boxShadow = '0 0 30px #4CAF50, inset 0 0 10px rgba(76, 175, 80, 0.2)';
            questionCard.style.border = '3px solid #4CAF50';
            
            // Add score celebration
            const scoreElement = document.getElementById('score');
            scoreElement.style.animation = 'correctPulse 0.8s ease';
            scoreElement.style.color = '#FF6B6B';
            scoreElement.style.transform = 'scale(1.2)';
            
            setTimeout(() => {
                questionCard.style.animation = '';
                questionCard.style.boxShadow = '0 8px 16px rgba(0,0,0,0.1)';
                questionCard.style.border = '3px solid #4CAF50';
                scoreElement.style.animation = '';
                scoreElement.style.color = '#4CAF50';
                scoreElement.style.transform = 'scale(1)';
            }, 800);
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex >= quizQuestions.length) {
                showQuizResults();
            } else {
                loadQuestion();
            }
        }

        function showQuizResults() {
            const percentage = Math.round((quizScore / quizQuestions.length) * 100);
            let message = `Quiz Complete!\n\nFinal Score: ${quizScore}/10 (${percentage}%)\n\n`;
            
            if (percentage >= 80) {
                message += "🎉 Excellent work! You have mastered these concepts!";
            } else if (percentage >= 60) {
                message += "👍 Good job! Review the concepts and try again.";
            } else {
                message += "📚 Keep practicing! These concepts will become clearer with more work.";
            }
            alert(message);
        }

        function resetQuiz() {
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.textContent = '';
                zone.className = 'drop-zone';
            });
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.classList.remove('used');
                option.draggable = true;
            });
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
        }

        // Initialize on load
        window.addEventListener('load', initializeActivity);
    </script>
</body>
</html>
